{% extends 'base.html' %}
{% block content %}
<h1 class="text-center mb-4">{{ category.name }}</h1>

{% if category.description %}
<div class="card mb-4">
    <div class="card-body">
        <p class="mb-0">{{ category.description }}</p>
    </div>
</div>
{% endif %}

<p class="text-muted">Showing {{ polls|length }} poll{{ polls|length|pluralize }} in this category</p>

{% if polls %}
    {% for question in polls %}
    <div class="card mb-3">
        <div class="row no-gutters">
            {% if question.image %}
            <div class="col-md-3">
                <img src="{{ question.image.url }}" class="card-img" alt="Poll image" style="height: 200px; object-fit: cover;">
            </div>
            {% endif %}
            <div class="{% if question.image %}col-md-9{% else %}col-md-12{% endif %}">
                <div class="card-body">
                    <h5 class="card-title">{{ question.question_text }}</h5>
                    
                    {% if question.description %}
                        <p class="text-muted small">{{ question.description|truncatewords:20 }}</p>
                    {% endif %}
                    
                    <div class="mb-2">
                        {% if question.allow_multiple_choices %}
                            <span class="badge badge-warning">Multiple Choice</span>
                        {% endif %}
                        
                        {% if question.visibility == 'password' %}
                            <span class="badge badge-secondary">Password Protected</span>
                        {% elif question.visibility == 'private' %}
                            <span class="badge badge-dark">Private</span>
                            {% if user.is_authenticated and user in question.invited_users.all %}
                                <span class="badge badge-info">Invited</span>
                            {% endif %}
                        {% endif %}
                        
                        {% if question.is_active %}
                            <span class="badge badge-success">Active</span>
                        {% elif question.is_expired %}
                            <span class="badge badge-danger">Expired</span>
                        {% endif %}
                        
                        {% if user.is_authenticated and question.id in user_votes %}
                            <span class="badge badge-primary">You Voted</span>
                        {% endif %}
                    </div>
                    
                    <p class="text-muted small mb-2">
                        <strong>Total Votes:</strong> {{ question.total_votes }} | 
                        <strong>Posted:</strong> {{ question.pub_date|date:"M d, Y" }}
                        {% if question.end_date %}
                            | <strong>Ends:</strong> {{ question.end_date|date:"M d, Y H:i" }}
                        {% endif %}
                    </p>
                    
                    <div class="mt-2">
                        {% if question.is_active %}
                            {% if user.is_authenticated %}
                                <a href="{% url 'polls:detail' question.id %}" class="btn btn-primary btn-sm">
                                    {% if question.id in user_votes %}Change Vote{% else %}Vote Now!{% endif %}
                                </a>
                            {% else %}
                                <a href="{% url 'accounts:login' %}?next={% url 'polls:detail' question.id %}" class="btn btn-primary btn-sm">Login to Vote</a>
                            {% endif %}
                        {% else %}
                            <button class="btn btn-secondary btn-sm" disabled>Poll Closed</button>
                        {% endif %}
                        <a href="{% url 'polls:results' question.id %}" class="btn btn-outline-secondary btn-sm">View Results</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="alert alert-info">
        <p class="mb-0">No active polls in this category yet.</p>
    </div>
{% endif %}

<a href="{% url 'polls:index' %}" class="btn btn-secondary">Back to All Polls</a>
{% endblock %}
